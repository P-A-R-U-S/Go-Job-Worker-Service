---
authors: Valentyn Ponomarenko (ValentynPonomarenko@gmail.com)
state: draft
---

# RFD 00001 - Job Worker Service

## Required Approvers

Engineering: [@smallinsky](https://github.com/smallinsky) || [@greedy52](https://github.com/greedy52) || [@r0mant](https://github.com/r0mant)  || [@russjones](https://github.com/russjones)


## What

Design job worker service (JobWorker) that enables authorized users run arbitrary
Linux command on remote hosts via cli.

## Why
This library can be used to execute arbitrary linux commands on a machine and provide basic 
resource control for the process using cgroups. 

The main purpose of this to test candidate skill and ability to create productions code and API, 
and let candidate know what it would be like to work at Teleport. But in general such worker can be 
used to run a variety of Linux processes on a remote machine:
- short-lived command - e.g. _$(which date)_
- long-lived command  - e.g. _bash -c 'for ((i=0; i<100;++i)); do echo index:$i; sleep 1; done'_

Also, each job process should be isolated based on security setting and controls resource consumptions,
prevent unauthorized access. 

## Details
The project should be composed of three components:

* **Library** - reusable Go library that provide base functionality to start/stop
  and query status of the job, as well as able to stream the output generated by the job.
  The library should support multiple concurrent clients simultaneously and the job output
  availability should be limited by client permission. Each job should be assigned to it own CPU,
  Memory and DiskIO groups to limit process resource consumptions.

* **API** - [gRPC](https://grpc.io/) API server side application that enables mTLS client authentication
  and verify client certificate. API should handle and report clear errors and not crash under non-critical
  conditions.

  _**Note:**_ set up strong set of cipher suites for TLS and good crypto setup for certificates.

  _**Warning:**_ not any other authentication protocols should be used on top of mTLS.

* **Client** - the client should be deigned as command line interface (cli) and connect to the API
  and provide same set of operation (start/stop/query status/stream output of the job)

_**Note:** the team proposed Golang language as preferable_

#### Assumptions
* no user hierarchy and all user are isolated (all user equal and not able to start/stop/query command from other users)
* due to limit of time and scope we should support cgroups v1 and cgroups should be setup on the machine
* machine has enough memory to run all the job and store job's output in memory 

#### Not supported (Out of scope)
* high availability (single instance run on single Linux 64-bit machine)

### Client/CLI 